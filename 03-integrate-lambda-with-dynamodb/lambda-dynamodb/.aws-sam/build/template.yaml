AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'lambda-dynamodb

  Sample SAM Template for lambda-dynamodb

  '
Globals:
  Function:
    Timeout: 15
Resources:
  MyTableWriteAccessPolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyName: MyTableWriteAccess
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:PutItem
          Resource:
            Ref: MyTable
      Roles:
      - Ref: CreateFunctionRole
  MyTableReadAccessPolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyName: MyTableReadAccess
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:GetItem
          Resource:
            Ref: MyTable
      Roles:
      - Ref: GetDetailFunctionRole
  GetDetailFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: GetDetailFunction
      Handler: app.detail
      Runtime: nodejs14.x
      Events:
        Create:
          Type: Api
          Properties:
            Path: /detail/{id}
            Method: get
  CreateFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: CreateFunction
      Handler: app.create
      Runtime: nodejs14.x
      Events:
        Create:
          Type: Api
          Properties:
            Path: /create
            Method: post
  MyTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: MyTable
      AttributeDefinitions:
      - AttributeName: PK
        AttributeType: S
      - AttributeName: SK
        AttributeType: N
      KeySchema:
      - AttributeName: PK
        KeyType: HASH
      - AttributeName: SK
        KeyType: RANGE
      ProvisionedThroughput:
        ReadCapacityUnits: 5
        WriteCapacityUnits: 5
Outputs:
  BackendApi:
    Description: API Gateway endpoint URL for Prod stage for Hello World function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/
